diff --git a/node_modules/plasmo/dist/index.js b/node_modules/plasmo/dist/index.js
index ec005cd..3446c99 100644
--- a/node_modules/plasmo/dist/index.js
+++ b/node_modules/plasmo/dist/index.js
@@ -22,7 +22,7 @@ ${Ri}
 ${Ri}
       --zip                       zip the build output
 `});var fe,ir,Ze=y(()=>{k();dn();at();fe=()=>{console.log("\u{1F7E3} Plasmo v0.90.5"),console.log("\u{1F534} The Browser Extension Framework")},ir=()=>{$e("\u{1F7E0} CMDS",mn.join(" | ")),$e("\u{1F7E1} OPTS",Bi)}});var ji={};Xe(ji,{default:()=>Yl});async function zl(){fe(),ir()}var Yl,Ui=y(()=>{Ze();Yl=zl});var qi={};Xe(qi,{default:()=>Xl});async function Kl(){N("Start the extension development...")}var Xl,Wi=y(()=>{k();Xl=Kl});import{constants as hn}from"fs";import{access as Zl,mkdir as Ql,readdir as ef,stat as Vi}from"fs/promises";async function gn(t,e){try{return await Zl(t,e),!0}catch{return!1}}async function sr(t){return gn(t,hn.W_OK)}async function or(t){return gn(t,hn.R_OK)}async function A(t){return gn(t,hn.F_OK)}async function Hi(t){try{return(await Vi(t)).isDirectory()}catch{return!1}}async function ar(t){try{return(await Vi(t)).isFile()}catch{return!1}}async function rf(t){let e=(await ef(t,{withFileTypes:!0})).filter(r=>!tf.has(r.name)).filter(r=>!/\.iml$/.test(r.name));if(e.length>0){d(`Found conflicting contents in ${t}`);let r=e.reduce((n,i)=>`${n}
-	${i.name}${i.isDirectory()?"/":""}`,"");return d(r),!1}return!0}async function Gi(t){if(!await sr(t))d("Directory does not exist, creating..."),await Ql(t);else{if(d("Directory exists, checking if it is empty..."),!await rf(t))throw new Error(`Directory ${t} is not empty.`);if(d("Checking if directory is writable..."),!await sr(t))throw new Error(`Directory ${t} is not accesible.`)}}var tf,X=y(()=>{k();tf=new Set([".DS_Store",".git",".gitattributes",".gitignore",".gitlab-ci.yml",".hg",".hgcheck",".hgignore",".idea",".npmignore",".travis.yml","LICENSE","Thumbs.db","docs","mkdocs.yml","npm-debug.log","yarn-debug.log","yarn-error.log",".pnpm-debug.log"])});import{existsSync as nf}from"fs";import{basename as sf,resolve as se}from"path";import{cwd as of}from"process";var ct,cr=y(()=>{at();ct=(t=of())=>{let e=Be();process.env.PLASMO_PROJECT_DIR=t;let r=sf(t);process.env.PLASMO_SRC_PATH=e.srcPath;let n=se(t,e.srcPath);process.env.PLASMO_SRC_DIR=nf(n)?n:t,process.env.PLASMO_BUILD_PATH=e.buildPath;let i=se(t,e.buildPath);process.env.PLASMO_BUILD_DIR=i;let s=`${e.target}-${e.tag}`,o=se(i,s),a=se(t,".plasmo"),l=se(a,"cache");return{packageName:r,projectDirectory:t,buildDirectory:i,distDirectory:o,distDirectoryName:s,sourceDirectory:process.env.PLASMO_SRC_DIR,packageFilePath:se(t,"package.json"),gitIgnorePath:se(t,".gitignore"),assetsDirectory:se(t,"assets"),parcelConfig:se(t,".parcelrc"),dotPlasmoDirectory:a,cacheDirectory:l,plasmoVersionFilePath:se(l,"plasmo.version.json"),staticDirectory:se(a,"static"),genAssetsDirectory:se(a,"gen-assets"),entryManifestPath:se(a,`${e.target}.plasmo.manifest.json`)}}});import af from"@expo/spawn-async";import cf from"semver";async function yn(t){let e=await af(t,["--version"]),r=cf.valid(e.stdout.trim())||void 0;return{name:t,version:r}}async function lt(){try{let t=process.env.npm_config_user_agent;if(t){if(t.startsWith("yarn"))return{name:"yarn"};if(t.startsWith("pnpm"))return{name:"pnpm"}}try{return await yn("pnpm")}catch{return await yn("yarn")}}catch{return await yn("npm")}}var lr=y(()=>{});var q=x(_n=>{"use strict";_n.fromCallback=function(t){return Object.defineProperty(function(...e){if(typeof e[e.length-1]=="function")t.apply(this,e);else return new Promise((r,n)=>{t.call(this,...e,(i,s)=>i!=null?n(i):r(s))})},"name",{value:t.name})};_n.fromPromise=function(t){return Object.defineProperty(function(...e){let r=e[e.length-1];if(typeof r!="function")return t.apply(this,e);t.apply(this,e.slice(0,-1)).then(n=>r(null,n),r)},"name",{value:t.name})}});var zi=x((qg,Ji)=>{var je=v("constants"),lf=process.cwd,fr=null,ff=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return fr||(fr=lf.call(process)),fr};try{process.cwd()}catch{}typeof process.chdir=="function"&&(wn=process.chdir,process.chdir=function(t){fr=null,wn.call(process,t)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,wn));var wn;Ji.exports=uf;function uf(t){je.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(t),t.lutimes||r(t),t.chown=s(t.chown),t.fchown=s(t.fchown),t.lchown=s(t.lchown),t.chmod=n(t.chmod),t.fchmod=n(t.fchmod),t.lchmod=n(t.lchmod),t.chownSync=o(t.chownSync),t.fchownSync=o(t.fchownSync),t.lchownSync=o(t.lchownSync),t.chmodSync=i(t.chmodSync),t.fchmodSync=i(t.fchmodSync),t.lchmodSync=i(t.lchmodSync),t.stat=a(t.stat),t.fstat=a(t.fstat),t.lstat=a(t.lstat),t.statSync=l(t.statSync),t.fstatSync=l(t.fstatSync),t.lstatSync=l(t.lstatSync),t.chmod&&!t.lchmod&&(t.lchmod=function(c,u,p){p&&process.nextTick(p)},t.lchmodSync=function(){}),t.chown&&!t.lchown&&(t.lchown=function(c,u,p,m){m&&process.nextTick(m)},t.lchownSync=function(){}),ff==="win32"&&(t.rename=typeof t.rename!="function"?t.rename:function(c){function u(p,m,h){var g=Date.now(),_=0;c(p,m,function S(C){if(C&&(C.code==="EACCES"||C.code==="EPERM"||C.code==="EBUSY")&&Date.now()-g<6e4){setTimeout(function(){t.stat(m,function(T,Y){T&&T.code==="ENOENT"?c(p,m,S):h(C)})},_),_<100&&(_+=10);return}h&&h(C)})}return Object.setPrototypeOf&&Object.setPrototypeOf(u,c),u}(t.rename)),t.read=typeof t.read!="function"?t.read:function(c){function u(p,m,h,g,_,S){var C;if(S&&typeof S=="function"){var T=0;C=function(Y,de,Fe){if(Y&&Y.code==="EAGAIN"&&T<10)return T++,c.call(t,p,m,h,g,_,C);S.apply(this,arguments)}}return c.call(t,p,m,h,g,_,C)}return Object.setPrototypeOf&&Object.setPrototypeOf(u,c),u}(t.read),t.readSync=typeof t.readSync!="function"?t.readSync:function(c){return function(u,p,m,h,g){for(var _=0;;)try{return c.call(t,u,p,m,h,g)}catch(S){if(S.code==="EAGAIN"&&_<10){_++;continue}throw S}}}(t.readSync);function e(c){c.lchmod=function(u,p,m){c.open(u,je.O_WRONLY|je.O_SYMLINK,p,function(h,g){if(h){m&&m(h);return}c.fchmod(g,p,function(_){c.close(g,function(S){m&&m(_||S)})})})},c.lchmodSync=function(u,p){var m=c.openSync(u,je.O_WRONLY|je.O_SYMLINK,p),h=!0,g;try{g=c.fchmodSync(m,p),h=!1}finally{if(h)try{c.closeSync(m)}catch{}else c.closeSync(m)}return g}}function r(c){je.hasOwnProperty("O_SYMLINK")&&c.futimes?(c.lutimes=function(u,p,m,h){c.open(u,je.O_SYMLINK,function(g,_){if(g){h&&h(g);return}c.futimes(_,p,m,function(S){c.close(_,function(C){h&&h(S||C)})})})},c.lutimesSync=function(u,p,m){var h=c.openSync(u,je.O_SYMLINK),g,_=!0;try{g=c.futimesSync(h,p,m),_=!1}finally{if(_)try{c.closeSync(h)}catch{}else c.closeSync(h)}return g}):c.futimes&&(c.lutimes=function(u,p,m,h){h&&process.nextTick(h)},c.lutimesSync=function(){})}function n(c){return c&&function(u,p,m){return c.call(t,u,p,function(h){f(h)&&(h=null),m&&m.apply(this,arguments)})}}function i(c){return c&&function(u,p){try{return c.call(t,u,p)}catch(m){if(!f(m))throw m}}}function s(c){return c&&function(u,p,m,h){return c.call(t,u,p,m,function(g){f(g)&&(g=null),h&&h.apply(this,arguments)})}}function o(c){return c&&function(u,p,m){try{return c.call(t,u,p,m)}catch(h){if(!f(h))throw h}}}function a(c){return c&&function(u,p,m){typeof p=="function"&&(m=p,p=null);function h(g,_){_&&(_.uid<0&&(_.uid+=4294967296),_.gid<0&&(_.gid+=4294967296)),m&&m.apply(this,arguments)}return p?c.call(t,u,p,h):c.call(t,u,h)}}function l(c){return c&&function(u,p){var m=p?c.call(t,u,p):c.call(t,u);return m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),m}}function f(c){if(!c||c.code==="ENOSYS")return!0;var u=!process.getuid||process.getuid()!==0;return!!(u&&(c.code==="EINVAL"||c.code==="EPERM"))}}});var Xi=x((Wg,Ki)=>{var Yi=v("stream").Stream;Ki.exports=pf;function pf(t){return{ReadStream:e,WriteStream:r};function e(n,i){if(!(this instanceof e))return new e(n,i);Yi.call(this);var s=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var o=Object.keys(i),a=0,l=o.length;a<l;a++){var f=o[a];this[f]=i[f]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){s._read()});return}t.open(this.path,this.flags,this.mode,function(c,u){if(c){s.emit("error",c),s.readable=!1;return}s.fd=u,s.emit("open",u),s._read()})}function r(n,i){if(!(this instanceof r))return new r(n,i);Yi.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var s=Object.keys(i),o=0,a=s.length;o<a;o++){var l=s[o];this[l]=i[l]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=t.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var Qi=x((Vg,Zi)=>{"use strict";Zi.exports=df;var mf=Object.getPrototypeOf||function(t){return t.__proto__};function df(t){if(t===null||typeof t!="object")return t;if(t instanceof Object)var e={__proto__:mf(t)};else var e=Object.create(null);return Object.getOwnPropertyNames(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}});var ut=x((Hg,Sn)=>{var F=v("fs"),hf=zi(),gf=Xi(),yf=Qi(),ur=v("util"),J,mr;typeof Symbol=="function"&&typeof Symbol.for=="function"?(J=Symbol.for("graceful-fs.queue"),mr=Symbol.for("graceful-fs.previous")):(J="___graceful-fs.queue",mr="___graceful-fs.previous");function _f(){}function rs(t,e){Object.defineProperty(t,J,{get:function(){return e}})}var Qe=_f;ur.debuglog?Qe=ur.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Qe=function(){var t=ur.format.apply(ur,arguments);t="GFS4: "+t.split(/\n/).join(`
+	${i.name}${i.isDirectory()?"/":""}`,"");return d(r),!1}return!0}async function Gi(t){if(!await sr(t))d("Directory does not exist, creating..."),await Ql(t);else{if(d("Directory exists, checking if it is empty..."),!await rf(t))throw new Error(`Directory ${t} is not empty.`);if(d("Checking if directory is writable..."),!await sr(t))throw new Error(`Directory ${t} is not accesible.`)}}var tf,X=y(()=>{k();tf=new Set([".DS_Store",".git",".gitattributes",".gitignore",".gitlab-ci.yml",".hg",".hgcheck",".hgignore",".idea",".npmignore",".travis.yml","LICENSE","Thumbs.db","docs","mkdocs.yml","npm-debug.log","yarn-debug.log","yarn-error.log",".pnpm-debug.log"])});import{existsSync as nf}from"fs";import{basename as sf,resolve as se}from"path";import{cwd as of}from"process";var ct,cr=y(()=>{at();ct=(t=of())=>{let e=Be();process.env.PLASMO_PROJECT_DIR=t;let r=sf(t);process.env.PLASMO_SRC_PATH=e.srcPath;let n=se(t,e.srcPath);process.env.PLASMO_SRC_DIR=nf(n)?n:t,process.env.PLASMO_BUILD_PATH=e.buildPath;let i=se(t,e.buildPath);process.env.PLASMO_BUILD_DIR=i;let s=`${e.target}-${e.tag}`,o=se(i,s),a=se(t,".plasmo"),l=se(a,"cache");return{packageName:r,projectDirectory:t,buildDirectory:i,distDirectory:o,distDirectoryName:s,sourceDirectory:process.env.PLASMO_SRC_DIR,packageFilePath:se(t,"package.json"),gitIgnorePath:se(t,".gitignore"),assetsDirectory:se(t,"assets"),parcelConfig:se(t,".parcelrc"),dotPlasmoDirectory:a,cacheDirectory:l,plasmoVersionFilePath:se(l,"plasmo.version.json"),staticDirectory:se(a,"static"),genAssetsDirectory:se(a,"gen-assets"),entryManifestPath:se(a,`${e.target}.plasmo.manifest.json`)}}});import af from"@expo/spawn-async";import cf from"semver";async function yn(t){let e=await af(t,["--version"]),r=cf.valid(e.stdout.trim())||void 0;return{name:t,version:r}}async function lt(){try{let t=process.env.npm_config_user_agent;if(t){if(t.startsWith("yarn"))return{name:"yarn"};if(t.startsWith("pnpm"))return{name:"pnpm"}}try{return await yn("pnpm")}catch{return await yn("yarn")}}catch{return await yn("npm")}}var lr=y(()=>{});var q=x(_n=>{"use strict";_n.fromCallback=function(t){return Object.defineProperty(function(...e){if(typeof e[e.length-1]=="function")t.apply(this,e);else return new Promise((r,n)=>{e.push((i,s)=>i!=null?n(i):r(s)),t.apply(this,e)})},"name",{value:t.name})};_n.fromPromise=function(t){return Object.defineProperty(function(...e){let r=e[e.length-1];if(typeof r!="function")return t.apply(this,e);e.pop(),t.apply(this,e).then(n=>r(null,n),r)},"name",{value:t.name})}});var zi=x((qg,Ji)=>{var je=v("constants"),lf=process.cwd,fr=null,ff=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return fr||(fr=lf.call(process)),fr};try{process.cwd()}catch{}typeof process.chdir=="function"&&(wn=process.chdir,process.chdir=function(t){fr=null,wn.call(process,t)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,wn));var wn;Ji.exports=uf;function uf(t){je.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(t),t.lutimes||r(t),t.chown=s(t.chown),t.fchown=s(t.fchown),t.lchown=s(t.lchown),t.chmod=n(t.chmod),t.fchmod=n(t.fchmod),t.lchmod=n(t.lchmod),t.chownSync=o(t.chownSync),t.fchownSync=o(t.fchownSync),t.lchownSync=o(t.lchownSync),t.chmodSync=i(t.chmodSync),t.fchmodSync=i(t.fchmodSync),t.lchmodSync=i(t.lchmodSync),t.stat=a(t.stat),t.fstat=a(t.fstat),t.lstat=a(t.lstat),t.statSync=l(t.statSync),t.fstatSync=l(t.fstatSync),t.lstatSync=l(t.lstatSync),t.chmod&&!t.lchmod&&(t.lchmod=function(c,u,p){p&&process.nextTick(p)},t.lchmodSync=function(){}),t.chown&&!t.lchown&&(t.lchown=function(c,u,p,m){m&&process.nextTick(m)},t.lchownSync=function(){}),ff==="win32"&&(t.rename=typeof t.rename!="function"?t.rename:function(c){function u(p,m,h){var g=Date.now(),_=0;c(p,m,function S(C){if(C&&(C.code==="EACCES"||C.code==="EPERM"||C.code==="EBUSY")&&Date.now()-g<6e4){setTimeout(function(){t.stat(m,function(T,Y){T&&T.code==="ENOENT"?c(p,m,S):h(C)})},_),_<100&&(_+=10);return}h&&h(C)})}return Object.setPrototypeOf&&Object.setPrototypeOf(u,c),u}(t.rename)),t.read=typeof t.read!="function"?t.read:function(c){function u(p,m,h,g,_,S){var C;if(S&&typeof S=="function"){var T=0;C=function(Y,de,Fe){if(Y&&Y.code==="EAGAIN"&&T<10)return T++,c.call(t,p,m,h,g,_,C);S.apply(this,arguments)}}return c.call(t,p,m,h,g,_,C)}return Object.setPrototypeOf&&Object.setPrototypeOf(u,c),u}(t.read),t.readSync=typeof t.readSync!="function"?t.readSync:function(c){return function(u,p,m,h,g){for(var _=0;;)try{return c.call(t,u,p,m,h,g)}catch(S){if(S.code==="EAGAIN"&&_<10){_++;continue}throw S}}}(t.readSync);function e(c){c.lchmod=function(u,p,m){c.open(u,je.O_WRONLY|je.O_SYMLINK,p,function(h,g){if(h){m&&m(h);return}c.fchmod(g,p,function(_){c.close(g,function(S){m&&m(_||S)})})})},c.lchmodSync=function(u,p){var m=c.openSync(u,je.O_WRONLY|je.O_SYMLINK,p),h=!0,g;try{g=c.fchmodSync(m,p),h=!1}finally{if(h)try{c.closeSync(m)}catch{}else c.closeSync(m)}return g}}function r(c){je.hasOwnProperty("O_SYMLINK")&&c.futimes?(c.lutimes=function(u,p,m,h){c.open(u,je.O_SYMLINK,function(g,_){if(g){h&&h(g);return}c.futimes(_,p,m,function(S){c.close(_,function(C){h&&h(S||C)})})})},c.lutimesSync=function(u,p,m){var h=c.openSync(u,je.O_SYMLINK),g,_=!0;try{g=c.futimesSync(h,p,m),_=!1}finally{if(_)try{c.closeSync(h)}catch{}else c.closeSync(h)}return g}):c.futimes&&(c.lutimes=function(u,p,m,h){h&&process.nextTick(h)},c.lutimesSync=function(){})}function n(c){return c&&function(u,p,m){return c.call(t,u,p,function(h){f(h)&&(h=null),m&&m.apply(this,arguments)})}}function i(c){return c&&function(u,p){try{return c.call(t,u,p)}catch(m){if(!f(m))throw m}}}function s(c){return c&&function(u,p,m,h){return c.call(t,u,p,m,function(g){f(g)&&(g=null),h&&h.apply(this,arguments)})}}function o(c){return c&&function(u,p,m){try{return c.call(t,u,p,m)}catch(h){if(!f(h))throw h}}}function a(c){return c&&function(u,p,m){typeof p=="function"&&(m=p,p=null);function h(g,_){_&&(_.uid<0&&(_.uid+=4294967296),_.gid<0&&(_.gid+=4294967296)),m&&m.apply(this,arguments)}return p?c.call(t,u,p,h):c.call(t,u,h)}}function l(c){return c&&function(u,p){var m=p?c.call(t,u,p):c.call(t,u);return m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),m}}function f(c){if(!c||c.code==="ENOSYS")return!0;var u=!process.getuid||process.getuid()!==0;return!!(u&&(c.code==="EINVAL"||c.code==="EPERM"))}}});var Xi=x((Wg,Ki)=>{var Yi=v("stream").Stream;Ki.exports=pf;function pf(t){return{ReadStream:e,WriteStream:r};function e(n,i){if(!(this instanceof e))return new e(n,i);Yi.call(this);var s=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var o=Object.keys(i),a=0,l=o.length;a<l;a++){var f=o[a];this[f]=i[f]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){s._read()});return}t.open(this.path,this.flags,this.mode,function(c,u){if(c){s.emit("error",c),s.readable=!1;return}s.fd=u,s.emit("open",u),s._read()})}function r(n,i){if(!(this instanceof r))return new r(n,i);Yi.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var s=Object.keys(i),o=0,a=s.length;o<a;o++){var l=s[o];this[l]=i[l]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=t.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var Qi=x((Vg,Zi)=>{"use strict";Zi.exports=df;var mf=Object.getPrototypeOf||function(t){return t.__proto__};function df(t){if(t===null||typeof t!="object")return t;if(t instanceof Object)var e={__proto__:mf(t)};else var e=Object.create(null);return Object.getOwnPropertyNames(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}});var ut=x((Hg,Sn)=>{var F=v("fs"),hf=zi(),gf=Xi(),yf=Qi(),ur=v("util"),J,mr;typeof Symbol=="function"&&typeof Symbol.for=="function"?(J=Symbol.for("graceful-fs.queue"),mr=Symbol.for("graceful-fs.previous")):(J="___graceful-fs.queue",mr="___graceful-fs.previous");function _f(){}function rs(t,e){Object.defineProperty(t,J,{get:function(){return e}})}var Qe=_f;ur.debuglog?Qe=ur.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Qe=function(){var t=ur.format.apply(ur,arguments);t="GFS4: "+t.split(/\n/).join(`
 GFS4: `),console.error(t)});F[J]||(es=global[J]||[],rs(F,es),F.close=function(t){function e(r,n){return t.call(F,r,function(i){i||ts(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,mr,{value:t}),e}(F.close),F.closeSync=function(t){function e(r){t.apply(F,arguments),ts()}return Object.defineProperty(e,mr,{value:t}),e}(F.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Qe(F[J]),v("assert").equal(F[J].length,0)}));var es;global[J]||rs(global,F[J]);Sn.exports=xn(yf(F));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!F.__patched&&(Sn.exports=xn(F),F.__patched=!0);function xn(t){hf(t),t.gracefulify=xn,t.createReadStream=de,t.createWriteStream=Fe;var e=t.readFile;t.readFile=r;function r(w,b,E){return typeof b=="function"&&(E=b,b=null),B(w,b,E);function B(U,P,O,L){return e(U,P,function(I){I&&(I.code==="EMFILE"||I.code==="ENFILE")?ft([B,[U,P,O],I,L||Date.now(),Date.now()]):typeof O=="function"&&O.apply(this,arguments)})}}var n=t.writeFile;t.writeFile=i;function i(w,b,E,B){return typeof E=="function"&&(B=E,E=null),U(w,b,E,B);function U(P,O,L,I,H){return n(P,O,L,function(M){M&&(M.code==="EMFILE"||M.code==="ENFILE")?ft([U,[P,O,L,I],M,H||Date.now(),Date.now()]):typeof I=="function"&&I.apply(this,arguments)})}}var s=t.appendFile;s&&(t.appendFile=o);function o(w,b,E,B){return typeof E=="function"&&(B=E,E=null),U(w,b,E,B);function U(P,O,L,I,H){return s(P,O,L,function(M){M&&(M.code==="EMFILE"||M.code==="ENFILE")?ft([U,[P,O,L,I],M,H||Date.now(),Date.now()]):typeof I=="function"&&I.apply(this,arguments)})}}var a=t.copyFile;a&&(t.copyFile=l);function l(w,b,E,B){return typeof E=="function"&&(B=E,E=0),U(w,b,E,B);function U(P,O,L,I,H){return a(P,O,L,function(M){M&&(M.code==="EMFILE"||M.code==="ENFILE")?ft([U,[P,O,L,I],M,H||Date.now(),Date.now()]):typeof I=="function"&&I.apply(this,arguments)})}}var f=t.readdir;t.readdir=u;var c=/^v[0-5]\./;function u(w,b,E){typeof b=="function"&&(E=b,b=null);var B=c.test(process.version)?function(O,L,I,H){return f(O,U(O,L,I,H))}:function(O,L,I,H){return f(O,L,U(O,L,I,H))};return B(w,b,E);function U(P,O,L,I){return function(H,M){H&&(H.code==="EMFILE"||H.code==="ENFILE")?ft([B,[P,O,L],H,I||Date.now(),Date.now()]):(M&&M.sort&&M.sort(),typeof L=="function"&&L.call(this,H,M))}}}if(process.version.substr(0,4)==="v0.8"){var p=gf(t);S=p.ReadStream,T=p.WriteStream}var m=t.ReadStream;m&&(S.prototype=Object.create(m.prototype),S.prototype.open=C);var h=t.WriteStream;h&&(T.prototype=Object.create(h.prototype),T.prototype.open=Y),Object.defineProperty(t,"ReadStream",{get:function(){return S},set:function(w){S=w},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WriteStream",{get:function(){return T},set:function(w){T=w},enumerable:!0,configurable:!0});var g=S;Object.defineProperty(t,"FileReadStream",{get:function(){return g},set:function(w){g=w},enumerable:!0,configurable:!0});var _=T;Object.defineProperty(t,"FileWriteStream",{get:function(){return _},set:function(w){_=w},enumerable:!0,configurable:!0});function S(w,b){return this instanceof S?(m.apply(this,arguments),this):S.apply(Object.create(S.prototype),arguments)}function C(){var w=this;ke(w.path,w.flags,w.mode,function(b,E){b?(w.autoClose&&w.destroy(),w.emit("error",b)):(w.fd=E,w.emit("open",E),w.read())})}function T(w,b){return this instanceof T?(h.apply(this,arguments),this):T.apply(Object.create(T.prototype),arguments)}function Y(){var w=this;ke(w.path,w.flags,w.mode,function(b,E){b?(w.destroy(),w.emit("error",b)):(w.fd=E,w.emit("open",E))})}function de(w,b){return new t.ReadStream(w,b)}function Fe(w,b){return new t.WriteStream(w,b)}var Ae=t.open;t.open=ke;function ke(w,b,E,B){return typeof E=="function"&&(B=E,E=null),U(w,b,E,B);function U(P,O,L,I,H){return Ae(P,O,L,function(M,lg){M&&(M.code==="EMFILE"||M.code==="ENFILE")?ft([U,[P,O,L,I],M,H||Date.now(),Date.now()]):typeof I=="function"&&I.apply(this,arguments)})}}return t}function ft(t){Qe("ENQUEUE",t[0].name,t[1]),F[J].push(t),vn()}var pr;function ts(){for(var t=Date.now(),e=0;e<F[J].length;++e)F[J][e].length>2&&(F[J][e][3]=t,F[J][e][4]=t);vn()}function vn(){if(clearTimeout(pr),pr=void 0,F[J].length!==0){var t=F[J].shift(),e=t[0],r=t[1],n=t[2],i=t[3],s=t[4];if(i===void 0)Qe("RETRY",e.name,r),e.apply(null,r);else if(Date.now()-i>=6e4){Qe("TIMEOUT",e.name,r);var o=r.pop();typeof o=="function"&&o.call(null,n)}else{var a=Date.now()-s,l=Math.max(s-i,1),f=Math.min(l*1.2,100);a>=f?(Qe("RETRY",e.name,r),e.apply(null,r.concat([i]))):F[J].push(t)}pr===void 0&&(pr=setTimeout(vn,0))}}});var Q=x(Ce=>{"use strict";var ns=q().fromCallback,Z=ut(),wf=["access","appendFile","chmod","chown","close","copyFile","cp","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","glob","lchmod","lchown","lutimes","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","statfs","symlink","truncate","unlink","utimes","writeFile"].filter(t=>typeof Z[t]=="function");Object.assign(Ce,Z);wf.forEach(t=>{Ce[t]=ns(Z[t])});Ce.exists=function(t,e){return typeof e=="function"?Z.exists(t,e):new Promise(r=>Z.exists(t,r))};Ce.read=function(t,e,r,n,i,s){return typeof s=="function"?Z.read(t,e,r,n,i,s):new Promise((o,a)=>{Z.read(t,e,r,n,i,(l,f,c)=>{if(l)return a(l);o({bytesRead:f,buffer:c})})})};Ce.write=function(t,e,...r){return typeof r[r.length-1]=="function"?Z.write(t,e,...r):new Promise((n,i)=>{Z.write(t,e,...r,(s,o,a)=>{if(s)return i(s);n({bytesWritten:o,buffer:a})})})};Ce.readv=function(t,e,...r){return typeof r[r.length-1]=="function"?Z.readv(t,e,...r):new Promise((n,i)=>{Z.readv(t,e,...r,(s,o,a)=>{if(s)return i(s);n({bytesRead:o,buffers:a})})})};Ce.writev=function(t,e,...r){return typeof r[r.length-1]=="function"?Z.writev(t,e,...r):new Promise((n,i)=>{Z.writev(t,e,...r,(s,o,a)=>{if(s)return i(s);n({bytesWritten:o,buffers:a})})})};typeof Z.realpath.native=="function"?Ce.realpath.native=ns(Z.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")});var ss=x((Jg,is)=>{"use strict";var xf=v("path");is.exports.checkPath=function(e){if(process.platform==="win32"&&/[<>:"|?*]/.test(e.replace(xf.parse(e).root,""))){let n=new Error(`Path contains invalid characters: ${e}`);throw n.code="EINVAL",n}}});var ls=x((zg,bn)=>{"use strict";var os=Q(),{checkPath:as}=ss(),cs=t=>{let e={mode:511};return typeof t=="number"?t:{...e,...t}.mode};bn.exports.makeDir=async(t,e)=>(as(t),os.mkdir(t,{mode:cs(e),recursive:!0}));bn.exports.makeDirSync=(t,e)=>(as(t),os.mkdirSync(t,{mode:cs(e),recursive:!0}))});var ge=x((Yg,fs)=>{"use strict";var vf=q().fromPromise,{makeDir:Sf,makeDirSync:En}=ls(),Pn=vf(Sf);fs.exports={mkdirs:Pn,mkdirsSync:En,mkdirp:Pn,mkdirpSync:En,ensureDir:Pn,ensureDirSync:En}});var Ue=x((Kg,ps)=>{"use strict";var bf=q().fromPromise,us=Q();function Ef(t){return us.access(t).then(()=>!0).catch(()=>!1)}ps.exports={pathExists:bf(Ef),pathExistsSync:us.existsSync}});var kn=x((Xg,ms)=>{"use strict";var pt=Q(),Pf=q().fromPromise;async function kf(t,e,r){let n=await pt.open(t,"r+"),i=null;try{await pt.futimes(n,e,r)}finally{try{await pt.close(n)}catch(s){i=s}}if(i)throw i}function Cf(t,e,r){let n=pt.openSync(t,"r+");return pt.futimesSync(n,e,r),pt.closeSync(n)}ms.exports={utimesMillis:Pf(kf),utimesMillisSync:Cf}});var et=x((Zg,ys)=>{"use strict";var mt=Q(),W=v("path"),ds=q().fromPromise;function Of(t,e,r){let n=r.dereference?i=>mt.stat(i,{bigint:!0}):i=>mt.lstat(i,{bigint:!0});return Promise.all([n(t),n(e).catch(i=>{if(i.code==="ENOENT")return null;throw i})]).then(([i,s])=>({srcStat:i,destStat:s}))}function Lf(t,e,r){let n,i=r.dereference?o=>mt.statSync(o,{bigint:!0}):o=>mt.lstatSync(o,{bigint:!0}),s=i(t);try{n=i(e)}catch(o){if(o.code==="ENOENT")return{srcStat:s,destStat:null};throw o}return{srcStat:s,destStat:n}}async function Nf(t,e,r,n){let{srcStat:i,destStat:s}=await Of(t,e,n);if(s){if(Tt(i,s)){let o=W.basename(t),a=W.basename(e);if(r==="move"&&o!==a&&o.toLowerCase()===a.toLowerCase())return{srcStat:i,destStat:s,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!s.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`);if(!i.isDirectory()&&s.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`)}if(i.isDirectory()&&Cn(t,e))throw new Error(dr(t,e,r));return{srcStat:i,destStat:s}}function Tf(t,e,r,n){let{srcStat:i,destStat:s}=Lf(t,e,n);if(s){if(Tt(i,s)){let o=W.basename(t),a=W.basename(e);if(r==="move"&&o!==a&&o.toLowerCase()===a.toLowerCase())return{srcStat:i,destStat:s,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!s.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`);if(!i.isDirectory()&&s.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`)}if(i.isDirectory()&&Cn(t,e))throw new Error(dr(t,e,r));return{srcStat:i,destStat:s}}async function hs(t,e,r,n){let i=W.resolve(W.dirname(t)),s=W.resolve(W.dirname(r));if(s===i||s===W.parse(s).root)return;let o;try{o=await mt.stat(s,{bigint:!0})}catch(a){if(a.code==="ENOENT")return;throw a}if(Tt(e,o))throw new Error(dr(t,r,n));return hs(t,e,s,n)}function gs(t,e,r,n){let i=W.resolve(W.dirname(t)),s=W.resolve(W.dirname(r));if(s===i||s===W.parse(s).root)return;let o;try{o=mt.statSync(s,{bigint:!0})}catch(a){if(a.code==="ENOENT")return;throw a}if(Tt(e,o))throw new Error(dr(t,r,n));return gs(t,e,s,n)}function Tt(t,e){return e.ino&&e.dev&&e.ino===t.ino&&e.dev===t.dev}function Cn(t,e){let r=W.resolve(t).split(W.sep).filter(i=>i),n=W.resolve(e).split(W.sep).filter(i=>i);return r.every((i,s)=>n[s]===i)}function dr(t,e,r){return`Cannot ${r} '${t}' to a subdirectory of itself, '${e}'.`}ys.exports={checkPaths:ds(Nf),checkPathsSync:Tf,checkParentPaths:ds(hs),checkParentPathsSync:gs,isSrcSubdir:Cn,areIdentical:Tt}});var Ss=x((Qg,vs)=>{"use strict";var K=Q(),It=v("path"),{mkdirs:If}=ge(),{pathExists:Mf}=Ue(),{utimesMillis:Df}=kn(),Mt=et();async function Ff(t,e,r={}){typeof r=="function"&&(r={filter:r}),r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;
 
 	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0001");let{srcStat:n,destStat:i}=await Mt.checkPaths(t,e,"copy",r);if(await Mt.checkParentPaths(t,n,e,"copy"),!await ws(t,e,r))return;let o=It.dirname(e);await Mf(o)||await If(o),await xs(i,t,e,r)}async function ws(t,e,r){return r.filter?r.filter(t,e):!0}async function xs(t,e,r,n){let s=await(n.dereference?K.stat:K.lstat)(e);if(s.isDirectory())return Bf(s,t,e,r,n);if(s.isFile()||s.isCharacterDevice()||s.isBlockDevice())return Af(s,t,e,r,n);if(s.isSymbolicLink())return jf(t,e,r,n);throw s.isSocket()?new Error(`Cannot copy a socket file: ${e}`):s.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}async function Af(t,e,r,n,i){if(!e)return _s(t,r,n,i);if(i.overwrite)return await K.unlink(n),_s(t,r,n,i);if(i.errorOnExist)throw new Error(`'${n}' already exists`)}async function _s(t,e,r,n){if(await K.copyFile(e,r),n.preserveTimestamps){$f(t.mode)&&await Rf(r,t.mode);let i=await K.stat(e);await Df(r,i.atime,i.mtime)}return K.chmod(r,t.mode)}function $f(t){return(t&128)===0}function Rf(t,e){return K.chmod(t,e|128)}async function Bf(t,e,r,n,i){e||await K.mkdir(n);let s=[];for await(let o of await K.opendir(r)){let a=It.join(r,o.name),l=It.join(n,o.name);s.push(ws(a,l,i).then(f=>{if(f)return Mt.checkPaths(a,l,"copy",i).then(({destStat:c})=>xs(c,a,l,i))}))}await Promise.all(s),e||await K.chmod(n,t.mode)}async function jf(t,e,r,n){let i=await K.readlink(e);if(n.dereference&&(i=It.resolve(process.cwd(),i)),!t)return K.symlink(i,r);let s=null;try{s=await K.readlink(r)}catch(o){if(o.code==="EINVAL"||o.code==="UNKNOWN")return K.symlink(i,r);throw o}if(n.dereference&&(s=It.resolve(process.cwd(),s)),Mt.isSrcSubdir(i,s))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${s}'.`);if(Mt.isSrcSubdir(s,i))throw new Error(`Cannot overwrite '${s}' with '${i}'.`);return await K.unlink(r),K.symlink(i,r)}vs.exports=Ff});var Cs=x((ey,ks)=>{"use strict";var ee=ut(),Dt=v("path"),Uf=ge().mkdirsSync,qf=kn().utimesMillisSync,Ft=et();function Wf(t,e,r){typeof r=="function"&&(r={filter:r}),r=r||{},r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;
@@ -108,7 +108,7 @@ declare module "@plasmohq/messaging" {
   interface PortsMetadata extends MpMetadata {}
 }
 `});import{readFile as Hd}from"fs/promises";import{resolve as Uc}from"path";import Gd from"json5";var Vr,jc,Jd,zd,qc,Wc=y(()=>{Vr=$(z(),1);Si();gi();jc=".plasmo/index.d.ts",Jd=[hi,vi].map(t=>`import "./${t}"`).join(`
-`),zd=async(t,e)=>{let r=Uc(t.projectDirectory,"tsconfig.json"),n=await Hd(r,"utf8"),i=Gd.parse(n),s=new Set(i.include);s.has(e)||(i.include=[e,...s],await(0,Vr.outputJson)(r,i,{spaces:2}))},qc=async t=>{let e=Uc(t.projectDirectory,jc);await Promise.all([(0,Vr.outputFile)(e,Jd),zd(t,jc)])}});import{lstat as Yd}from"fs/promises";import{resolve as Kd}from"path";async function Gr({dotPlasmoDirectory:t,cacheDirectory:e}){await(0,Hr.emptyDir)(t),await(0,Hr.ensureDir)(e)}async function Vc(t){let e=Kd(t.cacheDirectory,"parcel","data.mdb");if(!await A(e))return;let i=(await Yd(e,{bigint:!0})).size/1024n**2n,s=Number(i)/1024;s>1.47&&(d(`Busting large build cache, size: ${s.toFixed(2)} GB`),await Gr(t))}var Hr,bi=y(()=>{Hr=$(z(),1);X();k()});import Xd from"package-json";import Ei from"semver";async function Zd(t=""){switch((await lt()).name){case"npm":return`"npm i -S plasmo@${t}"`;case"pnpm":return`"pnpm i plasmo@${t}"`;case"yarn":return`"yarn add plasmo@${t}"`}}var Jr,Hc,kt,Qt=y(()=>{Jr=$(z(),1);X();k();bi();lr();Hc=async t=>{let{plasmoVersionFilePath:e}=t;if(!await A(e))d("Plasmo version file not found, busting cache..."),await Gr(t);else{let r=await(0,Jr.readJson)(e),n=Ei.coerce(r.version),i=Ei.coerce("0.90.5");(!n||n.major<i.major||n.major===i.major&&n.minor<i.minor)&&(d("Plasmo updated, busting cache..."),await Gr(t))}await(0,Jr.writeJson)(e,{version:"0.90.5"})},kt=async()=>{let t="0.90.5";try{let r=(await Xd("plasmo",{version:"latest"})).version;if(Ei.lt(t,r)){let{default:n}=await import("chalk");j(n.yellowBright(`A new version of plasmo is available: v${r}`));let i=await Zd(r);$i(n.yellow(`Run ${i} to update`))}}catch(e){le('Error fetching package information for "plasmo"',e)}}});var Qd,zr,Gc=y(()=>{k();Qd=t=>N({target:t}),zr=(t,e=Qd)=>{if(Array.isArray(t))return t.map(r=>zr(r,e)).filter(r=>r!==void 0);if(typeof t=="object"){let r={};for(let n in t)t.hasOwnProperty(n)&&(r[n]=zr(t[n],e),r[n]===void 0&&delete r[n]);return Object.keys(r).length===0?void 0:r}else return e(t)}});import{createHash as eh}from"crypto";var Yr,Pi=y(()=>{Yr=t=>eh("md5").update(t).digest("hex").slice(0,18)});import{resolve as Yc}from"path";import{cwd as th}from"process";import Jc from"semver";var Kc,rh,nh,ih,Xc,zc,sh,Zc,Qc,ki=y(()=>{Kc=$(z(),1);zt();X();Pe();rh=["react","svelte","vue","vanilla"],nh=[".tsx",".svelte",".vue",".jsx"],ih=new Set(nh),Xc=t=>ih.has(t),zc="No supported UI library found.  You can file an RFC for a new UI Library here: https://github.com/PlasmoHQ/plasmo/issues",sh=async t=>{if(t.includes(":")){let[e,r]=t.split(":");switch(e){case"file":default:let n=await(0,Kc.readJson)(Yc(th(),r,"package.json"));return Jc.coerce(n.version)?.major}}else return Jc.coerce(t)?.major},Zc=async t=>{let e=t.dependencies??{},r=rh.find(o=>o in e);if(r===void 0)return{name:"vanilla",path:"vanilla",version:8427};let n=await sh(e[r]);if(n===void 0)throw new Error(zc);if(r==="react"&&n<18)return{name:r,path:"react17",version:n};let i=`${r}${n}`,s=Yc(t.templatePath.staticTemplatePath,i);if(!await A(s))throw new Error(zc);return{name:r,path:i,version:n}},Qc=t=>{switch(t){case"svelte":return{uiExts:[".svelte"],mountExt:".ts"};case"vue":return{uiExts:[".vue"],mountExt:".ts"};case"react":return{uiExts:[".tsx",".jsx"],mountExt:".tsx"};case"vanilla":return{uiExts:[".tsx",".jsx"],mountExt:".ts"};default:bt(t)}}});import{readFile as el,writeFile as oh}from"fs/promises";import{join as Ci,relative as ah,resolve as xe}from"path";var Ct,Kr,tl=y(()=>{Ct=$(z(),1);Kt();X();k();Et();Pi();Pe();ki();Kr=class{constructor(e){this.plasmoManifest=e}#i={};#s={};get projectPath(){return this.plasmoManifest.projectPath}get commonPath(){return this.plasmoManifest.commonPath}get mountExt(){return this.plasmoManifest.mountExt}async init(){let[e,...r]=await Promise.all([this.#n(),this.#t("popup"),this.#t("options"),this.#t("newtab"),this.#t("devtools"),this.#t("sidepanel")]);return r}#n=async()=>{let e=xe(this.plasmoManifest.templatePath.staticTemplatePath,"common"),r=xe(this.commonPath.staticDirectory,"common");return(0,Ct.copy)(e,r)};#t=async e=>{d(`Creating static templates for ${e}`);let r=this.projectPath[`${e}IndexList`],n=this.projectPath[`${e}HtmlList`],[i,s]=await Promise.all([r,n].map(c=>Me(c,A))),{staticDirectory:o}=this.commonPath;await(0,Ct.ensureDir)(o);let a=i!==void 0,l=a?ce(ah(o,i)):`~${e}`,f=xe(o,`${e}${this.mountExt}`);return await Promise.all([this.#e(`index${this.mountExt}`,f,{__plasmo_import_module__:l}),this.createPageHtml(e,s)]),a};generateHtml=async(e="",r="",n="")=>{let i={__plasmo_static_index_title__:this.plasmoManifest.name,__plasmo_static_script__:r};return await ar(n)?this.#r(n,e,{...i,"</body>":`<div id="__plasmo"></div><script src="${r}" type="module"></script></body>`}):this.#e("index.html",e,i)};createPageHtml=async(e,r="")=>{let n=xe(this.commonPath.dotPlasmoDirectory,`${e}.html`),i=`./static/${e}${this.mountExt}`;return this.generateHtml(n,i,r)};createPageMount=async e=>{d(`Creating page mount template for ${e.dir}`);let r=xe(this.commonPath.dotPlasmoDirectory,e.dir),n=xe(r,`${e.name}.html`);await(0,Ct.ensureDir)(r);let i=Xc(e.ext),s=xe(r,`${e.name}${this.mountExt}`),o=xe(this.commonPath.sourceDirectory,e.dir,`${e.name}.html`),a=await Promise.all(i?[this.#e(`index${this.mountExt}`,s,{__plasmo_import_module__:`~${ce(Ci(e.dir,e.name))}`}),this.generateHtml(n,`./${e.name}${this.mountExt}`,o)]:[this.generateHtml(n,`~${ce(Ci(e.dir,e.name))}${e.ext}`,o)]);return{htmlPath:n,wereFilesWritten:a.some(l=>l)}};createContentScriptMount=async e=>{d(`Creating content script mount for ${e.dir}`);let r=xe(this.commonPath.staticDirectory,e.dir);await(0,Ct.ensureDir)(r);let n=xe(r,`${e.name}${this.mountExt}`);return await this.#e(`content-script-ui-mount${this.mountExt}`,n,{__plasmo_mount_content_script__:`~${ce(Ci(e.dir,e.name))}`}),n};#o=async(e,r,n)=>{let i=Object.entries(n).reduce((o,[a,l])=>o.replaceAll(a,l),e),s=Yr(Buffer.from(i));return this.#s[r]===s?!1:(this.#s[r]=s,await oh(r,i),!0)};#r=async(e,r,n)=>{let i=await el(e,"utf8");return this.#o(i,r,n)};#e=async(e,r,n)=>(this.#i[e]||=await el(xe(this.plasmoManifest.staticScaffoldPath,e),"utf8"),this.#o(this.#i[e],r,n))}});import{ok as De}from"assert";import{readdir as rl}from"fs/promises";import{basename as ch,dirname as lh,extname as nl,isAbsolute as fh,join as uh,parse as il,relative as Xr,resolve as Ye}from"path";import{cwd as ph}from"process";import mh from"fast-glob";import{hasher as dh}from"node-object-hash";var ie,er,hh,gh,Ot,Pe=y(()=>{ie=$(z(),1);oi();zt();pn();X();k();Et();Ur();gi();cr();Mc();wi();xi();Dn();Wc();bi();Qt();Gc();tl();ki();er={16:"./gen-assets/icon16.plasmo.png",32:"./gen-assets/icon32.plasmo.png",48:"./gen-assets/icon48.plasmo.png",64:"./gen-assets/icon64.plasmo.png",128:"./gen-assets/icon128.plasmo.png"},hh=["storage"],gh=dh({trim:!0,sort:!0}),Ot=class{constructor(e){this.bundleConfig=e;this.data.icons=er,this.scaffolder=new Kr(this)}get browser(){return this.bundleConfig.browser}#i;get commonPath(){return ai(this.#i)}#s;get projectPath(){return ai(this.#s)}templatePath=xr();#n;get combinedEnv(){return De(this.#n),this.#n.combinedEnv}get publicEnv(){return De(this.#n),this.#n.plasmoPublicEnv}#t=new Set([".ts",".js"]);#o=new Set;#r;get uiLibrary(){return De(this.#r),this.#r.uiLibrary}get mountExt(){return De(this.#r),this.#r.uiExtMap.mountExt}get uiExts(){return De(this.#r),this.#r.uiExtMap.uiExts}#e="";#a="";data={};overideManifest={};packageData;contentScriptMap=new Map;get mainWorldScriptList(){let e=[];for(let r of this.contentScriptMap.values())r.world==="MAIN"&&e.push(r);return e}get hasMainWorldScript(){for(let e of this.contentScriptMap.values())if(e.world==="MAIN")return!0;return!1}copyMap=new Map;permissionSet=new Set;scaffolder;get changed(){return this.#e!==this.#a}get name(){return De(this.packageData),this.packageData.displayName}get dependencies(){return De(this.packageData),this.packageData.dependencies??this.packageData.peerDependencies}get devDependencies(){return De(this.packageData),this.packageData.devDependencies}get staticScaffoldPath(){return De(this.uiLibrary),Ye(this.templatePath.staticTemplatePath,this.uiLibrary.path)}async initEnv(e=ph()){this.#n=await Oc(e),this.#i=ct(e)}async startup(){await this.initEnv(),d(`Ensure exists: ${this.commonPath.dotPlasmoDirectory}`),await(0,ie.ensureDir)(this.commonPath.dotPlasmoDirectory),await Vc(this.commonPath),await Hc(this.commonPath),await Wr(this.commonPath),await qc(this.commonPath),await this.updateEnv(),await this.updatePackageData()}async postBuild(){if(await Promise.all(Array.from(this.copyMap,async([n,i])=>{await or(n)||await(0,ie.copy)(i,n)})),!process.env.POST_BUILD_SCRIPT)return;let e=Ye(process.env.POST_BUILD_SCRIPT);if(!(0,ie.existsSync)(e)){j("Post-build script is unavailable:",e);return}v(e)()}async updateEnv(){await this.initEnv(this.commonPath.projectDirectory),await Nc(this)}prefixDev=(e="")=>process.env.NODE_ENV==="development"?`DEV | ${e}`:e;async updatePackageData(){if(this.packageData=await(0,ie.readJson)(this.commonPath.packageFilePath),!this.packageData)throw new Error("Invalid package.json");this.data.version=this.packageData.version,this.data.author=this.packageData.author,this.data.name=this.prefixDev(this.packageData.displayName),this.data.description=this.packageData.description,this.packageData.homepage&&(this.data.homepage_url=this.packageData.homepage);for(let e of hh)`@plasmohq/${e}`in(this.packageData.dependencies||{})&&this.permissionSet.add(e);await this.#c(),this.overideManifest=await this.#l()}#c=async()=>{let e=await Zc(this),r=Qc(e.name);this.#r={uiLibrary:e,uiExtMap:r},this.#o=new Set(r.uiExts),this.uiExts.forEach(n=>{this.#t.add(n)}),this.#s=Ac(this.commonPath,this.browser,this.uiExts)};toggleOptions=(e=!1)=>(e?this.data.options_ui={page:"./options.html",open_in_tab:!0}:delete this.data.options_ui,this);toggleOverrides=(e,r=!1)=>(r?this.data.chrome_url_overrides={...this.data.chrome_url_overrides,[e]:`./${e}.html`}:delete this.data.chrome_url_overrides?.[e],this);toggleNewtab=(e=!1)=>this.toggleOverrides("newtab",e);toggleDevtools=(e=!1)=>(e?this.data.devtools_page="./devtools.html":delete this.data.devtools_page,this);isPathInvalid=e=>{if(e===void 0)return!0;let r=nl(e);if(!this.#t.has(r))return!0;let n=Ec(e);return!!(n.length>0&&n!==`.${this.browser}`||n.length===0&&(0,ie.existsSync)(e.replace(r,`.${this.browser}${r}`)))};toggleContentScript=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=await Ic(e);if(n?.isEmpty)return!1;d("Adding content script: ",e);let i=Xr(this.commonPath.dotPlasmoDirectory,e),s=nl(i),o=this.#o.has(s);if(this.uiLibrary?.name!=="vanilla"&&o){let l=uh("lab",i).replace(/(^src)[\\/]/,""),f=il(l);i=Xr(this.commonPath.dotPlasmoDirectory,await this.scaffolder.createContentScriptMount(f))}n?.config?.css&&n.config.css.length>0&&(n.config.css=n.config.css.map(l=>Xr(this.commonPath.dotPlasmoDirectory,Ye(lh(e),l))));let a=this.injectEnvToObj({matches:["<all_urls>"],js:[n?.config?.world==="MAIN"?i.split(s)[0]:i],...n?.config||{}});this.contentScriptMap.set(e,a)}else this.contentScriptMap.delete(e);return mc("cs_changed"),r};addDirectory=async(e,r,n)=>(0,ie.existsSync)(e)?rl(e,{withFileTypes:!0}).then(i=>Promise.all(i.filter(s=>s.isFile()&&n?n(s.name):!0).map(s=>Ye(e,s.name)).map(s=>r(s,!0)))).then(i=>i.includes(!0)):!1;addContentScriptsIndexFiles=async()=>{let e=this.projectPath.contentsDirectory;if(!await Hi(e))return!1;let r=[...this.#t].flatMap(n=>[`index${n}`,`index.${this.browser}${n}`]);return rl(e,{withFileTypes:!0}).then(n=>Promise.all(n.filter(i=>i.isDirectory()).map(i=>Ye(e,i.name)).map(i=>this.addDirectory(i,this.toggleContentScript,s=>r.includes(s))))).then(n=>n.includes(!0))};addContentScriptsDirectory=async(e=this.projectPath.contentsDirectory)=>Promise.all([this.addDirectory(e,this.toggleContentScript),this.addContentScriptsIndexFiles()]).then(r=>r.includes(!0));togglePage=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=Xr(this.commonPath.sourceDirectory,e),i=il(n),{wereFilesWritten:s}=await this.scaffolder.createPageMount(i);s&&(this.#e="")}else this.#e="";return r};addPagesDirectory=async e=>this.addDirectory(e,this.togglePage);write=(e=!1)=>{this.#a=this.#e;let r=this.toJSON();if(this.#e=gh.hash(r),!(!this.changed&&!e))return d("Hash changed, updating manifest"),(0,ie.writeJson)(this.commonPath.entryManifestPath,r,{spaces:2})};toJSON=()=>{let e={...this.data},{options_ui:r,permissions:n,content_scripts:i,background:s,...o}=this.overideManifest;return e.options_ui?.page&&(e.options_ui={...e.options_ui,...r}),e.permissions=[...new Set([...this.permissionSet,...n||[]])],e.permissions?.length===0&&delete e.permissions,this.bundleConfig.manifestVersion==="mv2"&&(e.background={...e.background,...s},Object.keys(e.background).length===0&&delete e.background,o.host_permissions?.length>0&&(e.permissions=[...e.permissions||[],...o.host_permissions])),e.content_scripts=[...Array.from(this.contentScriptMap.values()).filter(a=>a.world!=="MAIN"),...i||[]],e.content_scripts.length===0&&delete e.content_scripts,{...e,...o}};#l=async()=>{if(!this.packageData?.manifest)return{};let e=await this.prepareOverrideManifest();if((e.web_accessible_resources?.length||0)>0&&(e.web_accessible_resources=await this.resolveWAR(this.packageData.manifest.web_accessible_resources)),e.browser_specific_settings)switch(this.browser){case"edge":case"safari":e.browser_specific_settings={[this.browser]:e.browser_specific_settings[this.browser]};break;case"firefox":case"gecko":e.browser_specific_settings={gecko:e.browser_specific_settings.gecko};break;default:delete e.browser_specific_settings}return e.overrides&&e.overrides[this.browser]&&(e={...e,...e.overrides[this.browser]}),delete e.overrides,this.injectEnvToObj(e)};copyProjectFile=async e=>{try{if(e.startsWith("~"))return this.copyProjectFile(e.slice(1));if(e.includes("*")){let s=await mh(e,{cwd:this.commonPath.projectDirectory,onlyFiles:!0});return await Promise.all(s.map(this.copyProjectFile)),e}let r=fh(e)?e:Ye(this.commonPath.projectDirectory,e);if(!(!this.projectPath.isEntryPath(r)&&await(0,ie.pathExists)(r)))return e;let i=Ye(this.commonPath.distDirectory,e);return this.copyMap.set(i,r),ce(e)}catch{return e}};copyNodeModuleFile=async e=>{try{let r=v.resolve(e,{paths:[this.commonPath.projectDirectory]}),n=ch(r),i=Ye(this.commonPath.distDirectory,n);return this.copyMap.set(i,r),n}catch{return null}};injectEnvToObj=e=>zr(e,r=>typeof r!="string"?r:r.match(/^\$(\w+)$/)?this.combinedEnv[r.substring(1)]||void 0:Fi(r,this.combinedEnv))}});import{relative as yh,resolve as sl}from"path";var Zr,ol,al=y(()=>{Zr=$(z(),1);k();Et();Pe();ol=async({indexFilePath:t="",withMessaging:e=!1,withMainWorldScript:r=!1},n)=>{d("Creating BGSW entry");let i=sl(n.commonPath.staticDirectory,"background"),s=sl(i,"index.ts"),o=yh(i,t),a=[e&&'import "./messaging"',t&&`import "${ce(o).slice(0,-3)}"`,r&&'import "./main-world-scripts"'].filter(Boolean).join(`
+`),zd=async(t,e)=>{let r=Uc(t.projectDirectory,"tsconfig.json"),n=await Hd(r,"utf8"),i=Gd.parse(n),s=new Set(i.include);s.has(e)||(i.include=[e,...s],await(0,Vr.outputJson)(r,i,{spaces:2}))},qc=async t=>{let e=Uc(t.projectDirectory,jc);await Promise.all([(0,Vr.outputFile)(e,Jd),zd(t,jc)])}});import{lstat as Yd}from"fs/promises";import{resolve as Kd}from"path";async function Gr({dotPlasmoDirectory:t,cacheDirectory:e}){await(0,Hr.emptyDir)(t),await(0,Hr.ensureDir)(e)}async function Vc(t){let e=Kd(t.cacheDirectory,"parcel","data.mdb");if(!await A(e))return;let i=(await Yd(e,{bigint:!0})).size/1024n**2n,s=Number(i)/1024;s>1.47&&(d(`Busting large build cache, size: ${s.toFixed(2)} GB`),await Gr(t))}var Hr,bi=y(()=>{Hr=$(z(),1);X();k()});import Xd from"package-json";import Ei from"semver";async function Zd(t=""){switch((await lt()).name){case"npm":return`"npm i -S plasmo@${t}"`;case"pnpm":return`"pnpm i plasmo@${t}"`;case"yarn":return`"yarn add plasmo@${t}"`}}var Jr,Hc,kt,Qt=y(()=>{Jr=$(z(),1);X();k();bi();lr();Hc=async t=>{let{plasmoVersionFilePath:e}=t;if(!await A(e))d("Plasmo version file not found, busting cache..."),await Gr(t);else{let r=await(0,Jr.readJson)(e),n=Ei.coerce(r.version),i=Ei.coerce("0.90.5");(!n||n.major<i.major||n.major===i.major&&n.minor<i.minor)&&(d("Plasmo updated, busting cache..."),await Gr(t))}await(0,Jr.writeJson)(e,{version:"0.90.5"})},kt=async()=>{let t="0.90.5";try{let r=(await Xd("plasmo",{version:"latest"})).version;if(Ei.lt(t,r)){let{default:n}=await import("chalk");j(n.yellowBright(`A new version of plasmo is available: v${r}`));let i=await Zd(r);$i(n.yellow(`Run ${i} to update`))}}catch(e){le('Error fetching package information for "plasmo"',e)}}});var Qd,zr,Gc=y(()=>{k();Qd=t=>N({target:t}),zr=(t,e=Qd)=>{if(Array.isArray(t))return t.map(r=>zr(r,e)).filter(r=>r!==void 0);if(typeof t=="object"){let r={};for(let n in t)t.hasOwnProperty(n)&&(r[n]=zr(t[n],e),r[n]===void 0&&delete r[n]);return Object.keys(r).length===0?void 0:r}else return e(t)}});import{createHash as eh}from"crypto";var Yr,Pi=y(()=>{Yr=t=>eh("md5").update(t).digest("hex").slice(0,18)});import{resolve as Yc}from"path";import{cwd as th}from"process";import Jc from"semver";var Kc,rh,nh,ih,Xc,zc,sh,Zc,Qc,ki=y(()=>{Kc=$(z(),1);zt();X();Pe();rh=["react","svelte","vue","vanilla"],nh=[".tsx",".svelte",".vue",".jsx"],ih=new Set(nh),Xc=t=>ih.has(t),zc="No supported UI library found.  You can file an RFC for a new UI Library here: https://github.com/PlasmoHQ/plasmo/issues",sh=async t=>{if(t.includes(":")){let[e,r]=t.split(":");switch(e){case"file":default:let n=await(0,Kc.readJson)(Yc(th(),r,"package.json"));return Jc.coerce(n.version)?.major}}else return Jc.coerce(t)?.major},Zc=async t=>{let e=t.dependencies??{},r=rh.find(o=>o in e);if(r===void 0)return{name:"vanilla",path:"vanilla",version:8427};let n=await sh(e[r]);if(n===void 0)throw new Error(zc);if(r==="react"&&n<18)return{name:r,path:"react17",version:n};let i=`${r}${n}`,s=Yc(t.templatePath.staticTemplatePath,i);if(!await A(s))throw new Error(zc);return{name:r,path:i,version:n}},Qc=t=>{switch(t){case"svelte":return{uiExts:[".svelte"],mountExt:".ts"};case"vue":return{uiExts:[".vue"],mountExt:".ts"};case"react":return{uiExts:[".tsx",".jsx"],mountExt:".tsx"};case"vanilla":return{uiExts:[".tsx",".jsx"],mountExt:".ts"};default:bt(t)}}});import{readFile as el,writeFile as oh}from"fs/promises";import{join as Ci,relative as ah,resolve as xe}from"path";var Ct,Kr,tl=y(()=>{Ct=$(z(),1);Kt();X();k();Et();Pi();Pe();ki();Kr=class{constructor(e){this.plasmoManifest=e}#i={};#s={};get projectPath(){return this.plasmoManifest.projectPath}get commonPath(){return this.plasmoManifest.commonPath}get mountExt(){return this.plasmoManifest.mountExt}async init(){let[e,...r]=await Promise.all([this.#n(),this.#t("popup"),this.#t("options"),this.#t("newtab"),this.#t("devtools"),this.#t("sidepanel")]);return r}#n=async()=>{let e=xe(this.plasmoManifest.templatePath.staticTemplatePath,"common"),r=xe(this.commonPath.staticDirectory,"common");return(0,Ct.copy)(e,r)};#t=async e=>{d(`Creating static templates for ${e}`);let r=this.projectPath[`${e}IndexList`],n=this.projectPath[`${e}HtmlList`],[i,s]=await Promise.all([r,n].map(c=>Me(c,A))),{staticDirectory:o}=this.commonPath;await(0,Ct.ensureDir)(o);let a=i!==void 0,l=a?ce(ah(o,i)):`~${e}`,f=xe(o,`${e}${this.mountExt}`);return await Promise.all([this.#e(`index${this.mountExt}`,f,{__plasmo_import_module__:l}),this.createPageHtml(e,s)]),a};generateHtml=async(e="",r="",n="")=>{let i={__plasmo_static_index_title__:this.plasmoManifest.name,__plasmo_static_script__:r};return await ar(n)?this.#r(n,e,{...i,"</body>":`<div id="__plasmo"></div><script src="${r}" type="module"></script></body>`}):this.#e("index.html",e,i)};createPageHtml=async(e,r="")=>{let n=xe(this.commonPath.dotPlasmoDirectory,`${e}.html`),i=`./static/${e}${this.mountExt}`;return this.generateHtml(n,i,r)};createPageMount=async e=>{d(`Creating page mount template for ${e.dir}`);let r=xe(this.commonPath.dotPlasmoDirectory,e.dir),n=xe(r,`${e.name}.html`);await(0,Ct.ensureDir)(r);let i=Xc(e.ext),s=xe(r,`${e.name}${this.mountExt}`),o=xe(this.commonPath.sourceDirectory,e.dir,`${e.name}.html`),a=await Promise.all(i?[this.#e(`index${this.mountExt}`,s,{__plasmo_import_module__:`~${ce(Ci(e.dir,e.name))}`}),this.generateHtml(n,`./${e.name}${this.mountExt}`,o)]:[this.generateHtml(n,`~${ce(Ci(e.dir,e.name))}${e.ext}`,o)]);return{htmlPath:n,wereFilesWritten:a.some(l=>l)}};createContentScriptMount=async e=>{d(`Creating content script mount for ${e.dir}`);let r=xe(this.commonPath.staticDirectory,e.dir);await(0,Ct.ensureDir)(r);let n=xe(r,`${e.name}${this.mountExt}`);return await this.#e(`content-script-ui-mount${this.mountExt}`,n,{__plasmo_mount_content_script__:`~${ce(Ci(e.dir,e.name))}`}),n};#o=async(e,r,n)=>{let i=Object.entries(n).reduce((o,[a,l])=>o.replaceAll(a,l),e),s=Yr(Buffer.from(i));return this.#s[r]===s?!1:(this.#s[r]=s,await oh(r,i),!0)};#r=async(e,r,n)=>{let i=await el(e,"utf8");return this.#o(i,r,n)};#e=async(e,r,n)=>(this.#i[e]||=await el(xe(this.plasmoManifest.staticScaffoldPath,e),"utf8"),this.#o(this.#i[e],r,n))}});import{ok as De}from"assert";import{readdir as rl}from"fs/promises";import{basename as ch,dirname as lh,extname as nl,isAbsolute as fh,join as uh,parse as il,relative as Xr,resolve as Ye}from"path";import{cwd as ph}from"process";import mh from"fast-glob";import{hasher as dh}from"node-object-hash";var ie,er,hh,gh,Ot,Pe=y(()=>{ie=$(z(),1);oi();zt();pn();X();k();Et();Ur();gi();cr();Mc();wi();xi();Dn();Wc();bi();Qt();Gc();tl();ki();er={16:"./gen-assets/icon16.plasmo.png",32:"./gen-assets/icon32.plasmo.png",48:"./gen-assets/icon48.plasmo.png",64:"./gen-assets/icon64.plasmo.png",128:"./gen-assets/icon128.plasmo.png"},hh=["storage"],gh=dh({trim:!0,sort:!0}),Ot=class{constructor(e){this.bundleConfig=e;this.data.icons=er,this.scaffolder=new Kr(this)}get browser(){return this.bundleConfig.browser}#i;get commonPath(){return ai(this.#i)}#s;get projectPath(){return ai(this.#s)}templatePath=xr();#n;get combinedEnv(){return De(this.#n),this.#n.combinedEnv}get publicEnv(){return De(this.#n),this.#n.plasmoPublicEnv}#t=new Set([".ts",".js"]);#o=new Set;#r;get uiLibrary(){return De(this.#r),this.#r.uiLibrary}get mountExt(){return De(this.#r),this.#r.uiExtMap.mountExt}get uiExts(){return De(this.#r),this.#r.uiExtMap.uiExts}#e="";#a="";data={};overideManifest={};packageData;contentScriptMap=new Map;get mainWorldScriptList(){let e=[];for(let r of this.contentScriptMap.values())r.world==="MAIN"&&e.push(r);return e}get hasMainWorldScript(){for(let e of this.contentScriptMap.values())if(e.world==="MAIN")return!0;return!1}copyMap=new Map;permissionSet=new Set;scaffolder;get changed(){return this.#e!==this.#a}get name(){return De(this.packageData),this.packageData.displayName}get dependencies(){return De(this.packageData),this.packageData.dependencies??this.packageData.peerDependencies}get devDependencies(){return De(this.packageData),this.packageData.devDependencies}get staticScaffoldPath(){return De(this.uiLibrary),Ye(this.templatePath.staticTemplatePath,this.uiLibrary.path)}async initEnv(e=ph()){this.#n=await Oc(e),this.#i=ct(e)}async startup(){await this.initEnv(),d(`Ensure exists: ${this.commonPath.dotPlasmoDirectory}`),await(0,ie.ensureDir)(this.commonPath.dotPlasmoDirectory),await Vc(this.commonPath),await Hc(this.commonPath),await Wr(this.commonPath),await qc(this.commonPath),await this.updateEnv(),await this.updatePackageData()}async postBuild(){if(await Promise.all(Array.from(this.copyMap,async([n,i])=>{await or(n)||await(0,ie.copy)(i,n)})),!process.env.POST_BUILD_SCRIPT)return;let e=Ye(process.env.POST_BUILD_SCRIPT);if(!(0,ie.existsSync)(e)){j("Post-build script is unavailable:",e);return}v(e)()}async updateEnv(){await this.initEnv(this.commonPath.projectDirectory),await Nc(this)}prefixDev=(e="")=>process.env.NODE_ENV==="development"?`DEV | ${e}`:e;async updatePackageData(){if(this.packageData=await(0,ie.readJson)(this.commonPath.packageFilePath),!this.packageData)throw new Error("Invalid package.json");this.data.version=this.packageData.version,this.data.author=this.packageData.author,this.data.name=this.prefixDev(this.packageData.displayName),this.data.description=this.packageData.description,this.packageData.homepage&&(this.data.homepage_url=this.packageData.homepage);for(let e of hh)`@plasmohq/${e}`in(this.packageData.dependencies||{})&&this.permissionSet.add(e);await this.#c(),this.overideManifest=await this.#l()}#c=async()=>{let e=await Zc(this),r=Qc(e.name);this.#r={uiLibrary:e,uiExtMap:r},this.#o=new Set(r.uiExts),this.uiExts.forEach(n=>{this.#t.add(n)}),this.#s=Ac(this.commonPath,this.browser,this.uiExts)};toggleOptions=(e=!1)=>(e?this.data.options_ui={page:"./options.html",open_in_tab:!0}:delete this.data.options_ui,this);toggleOverrides=(e,r=!1)=>(r?this.data.chrome_url_overrides={...this.data.chrome_url_overrides,[e]:`./${e}.html`}:delete this.data.chrome_url_overrides?.[e],this);toggleNewtab=(e=!1)=>this.toggleOverrides("newtab",e);toggleDevtools=(e=!1)=>(e?this.data.devtools_page="./devtools.html":delete this.data.devtools_page,this);isPathInvalid=e=>{if(e===void 0)return!0;let r=nl(e);if(!this.#t.has(r))return!0;let n=Ec(e);return!!(n.length>0&&n!==`.${this.browser}`||n.length===0&&(0,ie.existsSync)(e.replace(r,`.${this.browser}${r}`)))};toggleContentScript=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=await Ic(e);if(n?.isEmpty)return!1;d("Adding content script: ",e);let i=Xr(this.commonPath.dotPlasmoDirectory,e),s=nl(i),o=this.#o.has(s);if(this.uiLibrary?.name!=="vanilla"&&o){let l=uh("lab",i).replace(/(^src)[\\/]/,""),f=il(l);i=Xr(this.commonPath.dotPlasmoDirectory,await this.scaffolder.createContentScriptMount(f))}n?.config?.css&&n.config.css.length>0&&(n.config.css=n.config.css.map(l=>Xr(this.commonPath.dotPlasmoDirectory,Ye(lh(e),l))));let a=this.injectEnvToObj({matches:["<all_urls>"],js:[n?.config?.world==="MAIN"?i.split(s)[0]:i],...n?.config||{}});this.contentScriptMap.set(e,a)}else this.contentScriptMap.delete(e);return mc("cs_changed"),r};addDirectory=async(e,r,n)=>(0,ie.existsSync)(e)?rl(e,{withFileTypes:!0}).then(i=>Promise.all(i.filter(s=>s.isFile()&&n?n(s.name):!0).map(s=>Ye(e,s.name)).map(s=>r(s,!0)))).then(i=>i.includes(!0)):!1;addContentScriptsIndexFiles=async()=>{let e=this.projectPath.contentsDirectory;if(!await Hi(e))return!1;let r=[...this.#t].flatMap(s=>[`index${s}`,`index.${this.browser}${s}`]),n=async s=>{let o=await rl(s,{withFileTypes:!0}),a=[];for(let l of o){let f=Ye(s,l.name);l.isDirectory()?a.push(...await n(f)):r.includes(l.name)&&a.push(await this.toggleContentScript(f,!0))}return a};return(await n(e)).includes(!0)};addContentScriptsDirectory=async(e=this.projectPath.contentsDirectory)=>Promise.all([this.addDirectory(e,this.toggleContentScript),this.addContentScriptsIndexFiles()]).then(r=>r.includes(!0));togglePage=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=Xr(this.commonPath.sourceDirectory,e),i=il(n),{wereFilesWritten:s}=await this.scaffolder.createPageMount(i);s&&(this.#e="")}else this.#e="";return r};addPagesDirectory=async e=>this.addDirectory(e,this.togglePage);write=(e=!1)=>{this.#a=this.#e;let r=this.toJSON();if(this.#e=gh.hash(r),!(!this.changed&&!e))return d("Hash changed, updating manifest"),(0,ie.writeJson)(this.commonPath.entryManifestPath,r,{spaces:2})};toJSON=()=>{let e={...this.data},{options_ui:r,permissions:n,content_scripts:i,background:s,...o}=this.overideManifest;return e.options_ui?.page&&(e.options_ui={...e.options_ui,...r}),e.permissions=[...new Set([...this.permissionSet,...n||[]])],e.permissions?.length===0&&delete e.permissions,this.bundleConfig.manifestVersion==="mv2"&&(e.background={...e.background,...s},Object.keys(e.background).length===0&&delete e.background,o.host_permissions?.length>0&&(e.permissions=[...e.permissions||[],...o.host_permissions])),e.content_scripts=[...Array.from(this.contentScriptMap.values()).filter(a=>a.world!=="MAIN"),...i||[]],e.content_scripts.length===0&&delete e.content_scripts,{...e,...o}};#l=async()=>{if(!this.packageData?.manifest)return{};let e=await this.prepareOverrideManifest();if((e.web_accessible_resources?.length||0)>0&&(e.web_accessible_resources=await this.resolveWAR(this.packageData.manifest.web_accessible_resources)),e.browser_specific_settings)switch(this.browser){case"edge":case"safari":e.browser_specific_settings={[this.browser]:e.browser_specific_settings[this.browser]};break;case"firefox":case"gecko":e.browser_specific_settings={gecko:e.browser_specific_settings.gecko};break;default:delete e.browser_specific_settings}return e.overrides&&e.overrides[this.browser]&&(e={...e,...e.overrides[this.browser]}),delete e.overrides,this.injectEnvToObj(e)};copyProjectFile=async e=>{try{if(e.startsWith("~"))return this.copyProjectFile(e.slice(1));if(e.includes("*")){let s=await mh(e,{cwd:this.commonPath.projectDirectory,onlyFiles:!0});return await Promise.all(s.map(this.copyProjectFile)),e}let r=fh(e)?e:Ye(this.commonPath.projectDirectory,e);if(!(!this.projectPath.isEntryPath(r)&&await(0,ie.pathExists)(r)))return e;let i=Ye(this.commonPath.distDirectory,e);return this.copyMap.set(i,r),ce(e)}catch{return e}};copyNodeModuleFile=async e=>{try{let r=v.resolve(e,{paths:[this.commonPath.projectDirectory]}),n=ch(r),i=Ye(this.commonPath.distDirectory,n);return this.copyMap.set(i,r),n}catch{return null}};injectEnvToObj=e=>zr(e,r=>typeof r!="string"?r:r.match(/^\$(\w+)$/)?this.combinedEnv[r.substring(1)]||void 0:Fi(r,this.combinedEnv))}});import{relative as yh,resolve as sl}from"path";var Zr,ol,al=y(()=>{Zr=$(z(),1);k();Et();Pe();ol=async({indexFilePath:t="",withMessaging:e=!1,withMainWorldScript:r=!1},n)=>{d("Creating BGSW entry");let i=sl(n.commonPath.staticDirectory,"background"),s=sl(i,"index.ts"),o=yh(i,t),a=[e&&'import "./messaging"',t&&`import "${ce(o).slice(0,-3)}"`,r&&'import "./main-world-scripts"'].filter(Boolean).join(`
 `);await(0,Zr.ensureDir)(i),await(0,Zr.outputFile)(s,a)}});import{relative as _h,resolve as wh}from"path";import{camelCase as cl}from"change-case";var ll,fl,ul=y(()=>{ll=$(z(),1);k();Et();Pe();fl=async t=>{try{let e=wh(t.commonPath.staticDirectory,"background","main-world-scripts.ts"),r=t.mainWorldScriptList.map(i=>{let s=i.js.map(c=>{let u=cl(c),p=`url:${ce(_h(t.commonPath.entryManifestPath,c))}`;return{importName:u,importPath:p}}),o=s.map(c=>`import ${c.importName} from "${c.importPath}"`).join(`
 `),a=s.map(c=>c.importName),l=Object.entries(i).reduce((c,[u,p])=>(u!=="js"&&(c[cl(u)]=p),c),{id:a.join("-"),js:[]}),f=JSON.stringify(l).replace(/"js":\[\]/,`"js":[${a.map(c=>`${c}.split("/").pop().split("?")[0]`).join(",")}]`);return[o,f]});if(r.length===0)return!1;t.permissionSet.add("scripting");let n=`${r.map(([i])=>i).join(`
 `)}
